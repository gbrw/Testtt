<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุญุฏู ูุฑุฉ ุงููุฏู</title>
    <link rel="stylesheet" href="styles.css">
    <!-- ุชุถููู Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- ุตูุญุฉ ุงูุจุฏุงูุฉ -->
    <div id="welcome-screen" class="screen active">
        <div class="container">
            <h1>ุชุญุฏู ูุฑุฉ ุงููุฏู</h1>
            <div class="form-group">
                <label for="player-name">ุงุณู ุงููุงุนุจ:</label>
                <input type="text" id="player-name" placeholder="ุฃุฏุฎู ุงุณูู ููุง" required>
            </div>
            <div class="buttons-container">
                <button onclick="handleCreateRoom()" id="create-room-btn" class="btn primary">ุฅูุดุงุก ุบุฑูุฉ</button>
                <button onclick="handleJoinRoomForm()" id="join-room-btn" class="btn secondary">ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ</button>
            </div>
            <div id="join-room-form" class="hidden">
                <div class="form-group">
                    <label for="room-code">ุฑูุฒ ุงูุบุฑูุฉ:</label>
                    <input type="text" id="room-code" placeholder="ุฃุฏุฎู ุฑูุฒ ุงูุบุฑูุฉ" required>
                </div>
                <div id="join-status"></div>
                <button onclick="handleJoinRoom()" id="confirm-join-btn" class="btn primary">ุงูุถูุงู</button>
            </div>
            <div id="created-room-info" class="hidden">
                <h3>ุชู ุฅูุดุงุก ุงูุบุฑูุฉ ุจูุฌุงุญ!</h3>
                <p>ุฑูุฒ ุงูุบุฑูุฉ ุงูุฎุงุต ุจู: <span id="room-code-display"></span></p>
                <p>ุดุงุฑู ูุฐุง ุงูุฑูุฒ ูุน ุฎุตูู ููุงูุถูุงู ุฅูู ุงููุนุจุฉ</p>
                <p id="waiting-message">ุจุงูุชุธุงุฑ ุงูุถูุงู ุงููุงุนุจ ุงูุขุฎุฑ...</p>
            </div>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงูุชุธุงุฑ ุงููุงุนุจ ุงูุขุฎุฑ -->
    <div id="waiting-screen" class="screen">
        <div class="container">
            <h2>ุจุงูุชุธุงุฑ ุงูุถูุงู ุงููุงุนุจ ุงูุขุฎุฑ...</h2>
            <div class="loader"></div>
            <p>ุฑูุฒ ุงูุบุฑูุฉ: <span id="waiting-room-code"></span></p>
        </div>
    </div>
<!-- ุฌููุฉ "ูุงุฐุง ุชุนุฑูุ" -->
<div id="knowledge-round" class="round-section">
    <h2>ุฌููุฉ: ูุงุฐุง ุชุนุฑูุ</h2>
    <div class="question-container">
        <h3 id="knowledge-question"></h3>
        <div class="answer-section">
            <input type="text" id="knowledge-answer" placeholder="ุงูุชุจ ุฅุฌุงุจุชู ููุง">
            <div class="buttons-container">
                <button id="submit-knowledge" class="btn primary">ุฅุฑุณุงู</button>
                <button id="pass-knowledge" class="btn secondary">ุชูุฑูุฑ</button>
            </div>
        </div>
        <p>ุงููุญุงููุงุช ุงููุชุจููุฉ: <span id="attempts-left">3</span></p>
    </div>
</div>

<!-- ุฌููุฉ "ุงููุฒุงุฏ" -->
<div id="auction-round" class="round-section hidden">
    <h2>ุฌููุฉ: ุงููุฒุงุฏ</h2>
    <div class="question-container">
        <h3 id="auction-question"></h3>
        <div class="bidding-section">
            <p>ุงููุฒุงูุฏุฉ ุงูุญุงููุฉ: <span id="current-bid">1</span></p>
            <div class="buttons-container">
                <button id="decrease-bid" class="btn secondary">-</button>
                <button id="increase-bid" class="btn secondary">+</button>
                <button id="submit-bid" class="btn primary">ุชุฃููุฏ</button>
                <button id="pass-bid" class="btn danger">ุชูุฑูุฑ</button>
            </div>
        </div>
        <div id="auction-answer-section" class="hidden">
            <p>ุนููู ุชูุฏูู <span id="required-answers">3</span> ุฅุฌุงุจุงุช:</p>
            <div id="auction-answers-container"></div>
            <button id="submit-answers" class="btn primary">ุฅุฑุณุงู ุงูุฅุฌุงุจุงุช</button>
        </div>
    </div>
</div>

<!-- ุฌููุฉ "ุงูุฌุฑุณ" -->
<div id="bell-round" class="round-section hidden">
    <h2>ุฌููุฉ: ุงูุฌุฑุณ</h2>
    <div class="question-container">
        <h3 id="bell-question"></h3>
        <button id="bell-button" class="bell-button">
            <img src="images/bell.svg" alt="ุฌุฑุณ">
        </button>
        <div id="bell-answer-section" class="answer-section hidden">
            <input type="text" id="bell-answer" placeholder="ุงูุชุจ ุฅุฌุงุจุชู ููุง">
            <button id="submit-bell-answer" class="btn primary">ุฅุฑุณุงู</button>
        </div>
    </div>
</div>

<!-- ุฌููุฉ "ูุณูุฑุฉ ูุงุนุจ" -->
<div id="career-round" class="round-section hidden">
    <h2>ุฌููุฉ: ูุณูุฑุฉ ูุงุนุจ</h2>
    <div class="question-container">
        <h3 id="career-question"></h3>
        <div class="answer-section">
            <input type="text" id="career-answer" placeholder="ุงูุชุจ ุงุณู ุงููุงุนุจ ููุง">
            <button id="submit-career" class="btn primary">ุฅุฑุณุงู</button>
        </div>
    </div>
</div>

<!-- ุดุงุดุฉ ุงููุชุงุฆุฌ -->
<div id="results-screen" class="screen">
    <div class="container">
        <h2>ุงูุชูุช ุงููุนุจุฉ!</h2>
        <div class="results-container">
            <div class="player-result">
                <h3 id="result-player1-name">ุงููุงุนุจ 1</h3>
                <div class="score-big" id="result-player1-score">0</div>
            </div>
            <div class="vs">VS</div>
            <div class="player-result">
                <h3 id="result-player2-name">ุงููุงุนุจ 2</h3>
                <div class="score-big" id="result-player2-score">0</div>
            </div>
        </div>
        <div id="winner-announcement"></div>
        <button id="play-again-btn" class="btn primary">ุงููุนุจ ูุฑุฉ ุฃุฎุฑู</button>
    </div>
</div>
    <!-- ุดุงุดุฉ ุงููุนุจุฉ - ูุณุฎุฉ ูุจุณุทุฉ ููุท ูุฅุธูุงุฑ ูุฌุงุญ ุงูุงูุถูุงู -->
    <div id="game-screen" class="screen">
    <!-- ุดุงุดุฉ ุงููุนุจุฉ -->
<div id="game-screen" class="screen">
    <div class="container">
        <div class="game-header">
            <div class="player-info">
                <h3 id="player1-name">ุงููุงุนุจ 1</h3>
                <div class="score" id="player1-score">0</div>
            </div>
            <div class="game-status">
                <div class="round-info">
                    <span>ุงูุฌููุฉ: </span>
                    <span id="current-round">1</span>/4
                </div>
                <div class="turn-info">
                    <span>ุงูุฏูุฑ: </span>
                    <span id="current-turn">ุงููุงุนุจ 1</span>
                </div>
            </div>
            <div class="player-info">
                <h3 id="player2-name">ุงููุงุนุจ 2</h3>
                <div class="score" id="player2-score">0</div>
            </div>
        </div>

        <div class="game-content">
            <div id="knowledge-round" class="round-section">
                <!-- ูุญุชูู ุฌููุฉ ุงููุนุฑูุฉ ููุฌูุฏ ุจุงููุนู -->
            </div>
            
            <div id="auction-round" class="round-section hidden">
                <!-- ูุญุชูู ุฌููุฉ ุงููุฒุงุฏ ููุฌูุฏ ุจุงููุนู -->
            </div>
            
            <div id="bell-round" class="round-section hidden">
                <!-- ูุญุชูู ุฌููุฉ ุงูุฌุฑุณ ููุฌูุฏ ุจุงููุนู -->
            </div>
            
            <div id="career-round" class="round-section hidden">
                <!-- ูุญุชูู ุฌููุฉ ุงููุณูุฑุฉ ููุฌูุฏ ุจุงููุนู -->
            </div>
        </div>
    </div>
</div>
    <!-- ุงููุตูุต ุงูุจุฑูุฌูุฉ ุงููุถููุฉ ูุจุงุดุฑุฉ - ูุญู ูุดููุฉ ุงููุงุชู ุงููุญููู -->
    <script>
        // --- ุฅุนุฏุงุฏุงุช Firebase ---
        console.log('ุชููุฆุฉ Firebase...');
        const firebaseConfig = {
            apiKey: "AIzaSyCdYrpdM_7UJ-5VWWoJ0usrQR7lsvqoFog",
            authDomain: "footballchallange.firebaseapp.com",
            databaseURL: "https://footballchallange-default-rtdb.firebaseio.com",
            projectId: "footballchallange",
            storageBucket: "footballchallange.firebasestorage.app",
            messagingSenderId: "717977440447",
            appId: "1:717977440447:web:cc60fe924b93869dca760a",
            measurementId: "G-WXRVK8N5EW"
        };

        // ุชููุฆุฉ Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // ุญุงูุฉ ุงููุนุจุฉ
        let gameState = {
            roomCode: null,
            playerId: null,
            isCreator: false,
            players: {},
            gameRef: null
        };
        
        // --- ุงููุธุงุฆู ุงููุณุงุนุฏุฉ ---
        
        // ุฅูุดุงุก ุฑูุฒ ุบุฑูุฉ ุนุดูุงุฆู
        function generateRoomCode() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }
        
        // ุฅุธูุงุฑ ุดุงุดุฉ ูุนููุฉ ูุฅุฎูุงุก ุงูุจููุฉ
        function showScreen(screenId) {
            console.log('ุนุฑุถ ุงูุดุงุดุฉ:', screenId);
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // ุนุฑุถ ุฑุณุงูุฉ ูููุณุชุฎุฏู
        function showToast(message, type = 'info') {
            alert(message);
            console.log(`[${type}] ${message}`);
        }
        
        // ุนุฑุถ ุญุงูุฉ ุงูุงูุถูุงู
        function showJoinStatus(message, type = 'info') {
            const statusElement = document.getElementById('join-status');
            if (statusElement) {
                statusElement.innerHTML = `<div class="${type}">${message}</div>`;
            }
            console.log(`[ุญุงูุฉ ุงูุงูุถูุงู - ${type}] ${message}`);
        }
        
        // --- ูุธุงุฆู Firebase ---
        
        // ุฅูุดุงุก ุบุฑูุฉ ุฌุฏูุฏุฉ
        function createRoom(playerName) {
            return new Promise((resolve, reject) => {
                try {
                    const roomCode = generateRoomCode();
                    const roomRef = database.ref('rooms/' + roomCode);
                    
                    roomRef.set({
                        status: 'waiting',
                        createdAt: firebase.database.ServerValue.TIMESTAMP,
                        players: {
                            player1: {
                                name: playerName,
                                score: 0,
                                ready: true
                            }
                        },
                        gameState: {
                            currentRound: 0,
                            currentQuestion: 0,
                            currentTurn: 'player1',
                            timeLeft: 0,
                            roundStarted: false
                        }
                    }).then(() => {
                        resolve(roomCode);
                    }).catch(error => {
                        console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุงูุบุฑูุฉ:', error);
                        reject(error);
                    });
                } catch (error) {
                    console.error('ุฎุทุฃ ุบูุฑ ูุชููุน:', error);
                    reject(error);
                }
            });
        }
        
        // ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ
        function joinRoom(roomCode, playerName) {
            return new Promise((resolve, reject) => {
                try {
                    const roomRef = database.ref('rooms/' + roomCode);
                    
                    roomRef.once('value')
                        .then(snapshot => {
                            if (!snapshot.exists()) {
                                throw new Error('ุงูุบุฑูุฉ ุบูุฑ ููุฌูุฏุฉ');
                            }
                            
                            const roomData = snapshot.val();
                            console.log('ุจูุงูุงุช ุงูุบุฑูุฉ:', roomData);
                            
                            if (roomData.status !== 'waiting') {
                                throw new Error('ุงููุนุจุฉ ูุฏ ุจุฏุฃุช ุจุงููุนู');
                            }
                            
                            if (roomData.players && roomData.players.player2) {
                                throw new Error('ุงูุบุฑูุฉ ููุชูุฆุฉ');
                            }
                            
                            // ุฅุถุงูุฉ ุงููุงุนุจ ุงูุซุงูู
                            return roomRef.child('players').update({
                                player2: {
                                    name: playerName,
                                    score: 0,
                                    ready: true
                                }
                            });
                        })
                        .then(() => {
                            // ุชุญุฏูุซ ุญุงูุฉ ุงูุบุฑูุฉ
                            return roomRef.update({
                                status: 'ready'
                            });
                        })
                        .then(() => {
                            resolve();
                        })
                        .catch(error => {
                            console.error('ุฎุทุฃ ูู ุงูุงูุถูุงู ุฅูู ุงูุบุฑูุฉ:', error);
                            reject(error);
                        });
                } catch (error) {
                    console.error('ุฎุทุฃ ุบูุฑ ูุชููุน:', error);
                    reject(error);
                }
            });
        }
        
        // ุงูุงุณุชูุงุน ููุชุบููุฑุงุช ูู ุงูุบุฑูุฉ
        function listenToRoomChanges(roomCode) {
            const roomRef = database.ref('rooms/' + roomCode);
            
            roomRef.on('value', snapshot => {
                if (!snapshot.exists()) {
                    showToast('ุชู ุญุฐู ุงูุบุฑูุฉ', 'error');
                    showScreen('welcome-screen');
                    return;
                }
                
                const roomData = snapshot.val();
                gameState.players = roomData.players || {};
                
                // ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู
                updateUI(roomData);
                
                // ุงูุชุญูู ูู ุงุณุชุนุฏุงุฏ ุงููุนุจุฉ
                if (roomData.status === 'ready' && gameState.isCreator) {
                    showScreen('game-screen');
                }
            });
            
            return roomRef;
        }
        
        // ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู
        function updateUI(roomData) {
            // ุชุญุฏูุซ ุฃุณูุงุก ุงููุงุนุจูู
            if (roomData.players) {
                if (roomData.players.player1) {
                    document.querySelectorAll('#player1-name').forEach(el => {
                        el.textContent = roomData.players.player1.name;
                    });
                }
                
                if (roomData.players.player2) {
                    document.querySelectorAll('#player2-name').forEach(el => {
                        el.textContent = roomData.players.player2.name;
                    });
                }
            }
        }
        
        // ุชููุฆุฉ ุงููุนุจุฉ
        function initGame(roomCode, playerId, isCreator) {
            gameState.roomCode = roomCode;
            gameState.playerId = playerId;
            gameState.isCreator = isCreator;
            
            // ุชุญุฏูุซ ุฑูุฒ ุงูุบุฑูุฉ ูู ุดุงุดุฉ ุงูุงูุชุธุงุฑ
            document.getElementById('waiting-room-code').textContent = roomCode;
            
            // ุงูุงุณุชูุงุน ููุชุบููุฑุงุช ูู ุงูุบุฑูุฉ
            gameState.gameRef = listenToRoomChanges(roomCode);
        }
        
        // --- ูุนุงูุฌุงุช ุงูุฃุญุฏุงุซ ุงููุจุงุดุฑุฉ ---
        
        // ูุนุงูุฌ ุฅูุดุงุก ุบุฑูุฉ
        function handleCreateRoom() {
            console.log('ุชู ุงูููุฑ ุนูู ุฒุฑ ุฅูุดุงุก ุบุฑูุฉ');
            
            const playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                showToast('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุงุนุจ', 'error');
                return;
            }
            
            // ุฅูุดุงุก ุบุฑูุฉ ุฌุฏูุฏุฉ
            createRoom(playerName).then(roomCode => {
                console.log('ุชู ุฅูุดุงุก ุงูุบุฑูุฉ ุจูุฌุงุญุ ุงูุฑูุฒ:', roomCode);
                
                // ุนุฑุถ ูุนูููุงุช ุงูุบุฑูุฉ
                document.getElementById('room-code-display').textContent = roomCode;
                document.getElementById('created-room-info').classList.remove('hidden');
                document.getElementById('join-room-form').classList.add('hidden');
                
                // ุชููุฆุฉ ุงููุนุจุฉ
                initGame(roomCode, 'player1', true);
                
                // ุจุนุฏ ุซุงููุชููุ ุฅุธูุงุฑ ุดุงุดุฉ ุงูุงูุชุธุงุฑ
                setTimeout(() => {
                    showScreen('waiting-screen');
                    showToast('ุชู ุฅูุดุงุก ุงูุบุฑูุฉ ุจูุฌุงุญ! ุงูุชุธุฑ ุงูุถูุงู ุงููุงุนุจ ุงูุขุฎุฑ', 'success');
                }, 2000);
            }).catch(error => {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุงูุบุฑูุฉ:', error);
                showToast('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅูุดุงุก ุงูุบุฑูุฉ: ' + error.message, 'error');
            });
        }
        
        // ูุนุงูุฌ ุฅุธูุงุฑ ูููุฐุฌ ุงูุงูุถูุงู
        function handleJoinRoomForm() {
            console.log('ุชู ุงูููุฑ ุนูู ุฒุฑ ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ');
            
            document.getElementById('created-room-info').classList.add('hidden');
            document.getElementById('join-room-form').classList.remove('hidden');
        }
        
        // ูุนุงูุฌ ุงูุงูุถูุงู ุฅูู ุบุฑูุฉ
        function handleJoinRoom() {
            console.log('ุชู ุงูููุฑ ุนูู ุฒุฑ ุชุฃููุฏ ุงูุงูุถูุงู');
            
            const playerName = document.getElementById('player-name').value.trim();
            const roomCode = document.getElementById('room-code').value.trim();
            
            if (!playerName) {
                showJoinStatus('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุงุนุจ', 'error');
                return;
            }
            
            if (!roomCode) {
                showJoinStatus('ูุฑุฌู ุฅุฏุฎุงู ุฑูุฒ ุงูุบุฑูุฉ', 'error');
                return;
            }
            
            // ุชุนุทูู ุงูุฒุฑ ููุคุดุฑ ุชุญููู
            const confirmJoinBtn = document.getElementById('confirm-join-btn');
            confirmJoinBtn.disabled = true;
            confirmJoinBtn.textContent = 'ุฌุงุฑู ุงูุงูุถูุงู...';
            showJoinStatus('ุฌุงุฑู ุงูุงูุถูุงู...', 'info');
            
            // ูุญุงููุฉ ุงูุงูุถูุงู
            joinRoom(roomCode, playerName).then(() => {
                console.log('ุชู ุงูุงูุถูุงู ุฅูู ุงูุบุฑูุฉ ุจูุฌุงุญ');
                
                // ุชููุฆุฉ ุงููุนุจุฉ
                initGame(roomCode, 'player2', false);
                
                // ุฅุธูุงุฑ ุดุงุดุฉ ุงููุนุจุฉ
                showScreen('game-screen');
                showToast('ุชู ุงูุงูุถูุงู ุฅูู ุงูุบุฑูุฉ ุจูุฌุงุญ!', 'success');
            }).catch(error => {
                console.error('ุฎุทุฃ ูู ุงูุงูุถูุงู ุฅูู ุงูุบุฑูุฉ:', error);
                showJoinStatus('ุญุฏุซ ุฎุทุฃ: ' + error.message, 'error');
            }).finally(() => {
                // ุฅุนุงุฏุฉ ุชูุนูู ุงูุฒุฑ
                confirmJoinBtn.disabled = false;
                confirmJoinBtn.textContent = 'ุงูุถูุงู';
            });
        }
        
        // ุงุณุชุฏุนุงุก ูุถูุงู ุณูุงูุฉ ุงูุชุดุบูู ุนูู ุงููุงุชู
        console.log('ุชู ุชุญููู ุงููุตูุต ุงูุจุฑูุฌูุฉ ุจูุฌุงุญ');
    </script>
    <!-- ุฅุถุงูุฉ ููุทู ุงููุนุจุฉ -->
<script src="js/game-logic.js"></script>

<script>
// ุงุณุชููุงู ูุธุงุฆู ุงููุนุจุฉ
document.addEventListener('DOMContentLoaded', function() {
    // ุฅุถุงูุฉ ูุนุงูุฌุงุช ุฃุญุฏุงุซ ููุฃุฒุฑุงุฑ ุงูุฎุงุตุฉ ุจุงููุนุจุฉ
    
    // ุฒุฑ ุชูุฏูู ุฅุฌุงุจุฉ ุงููุนุฑูุฉ
    const submitKnowledgeBtn = document.getElementById('submit-knowledge');
    if (submitKnowledgeBtn) {
        submitKnowledgeBtn.addEventListener('click', function() {
            const answer = document.getElementById('knowledge-answer').value.trim();
            if (!answer) {
                showToast('ูุฑุฌู ุฅุฏุฎุงู ุฅุฌุงุจุฉ', 'error');
                return;
            }
            
            if (checkKnowledgeAnswer(answer)) {
                showToast('ุฅุฌุงุจุฉ ุตุญูุญุฉ! ๐', 'success');
                
                // ุชุญุฏูุซ ุงููุชูุฌุฉ
                updatePlayerScore(gameState.playerId, 1);
                
                // ุงูุงูุชูุงู ููุณุคุงู ุงูุชุงูู
                moveToNextQuestion();
            } else {
                showToast('ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ', 'error');
            }
        });
    }
    
    // ุฒุฑ ุชูุฑูุฑ ุงููุนุฑูุฉ
    const passKnowledgeBtn = document.getElementById('pass-knowledge');
    if (passKnowledgeBtn) {
        passKnowledgeBtn.addEventListener('click', function() {
            // ุชุบููุฑ ุงูุฏูุฑ ููุงุนุจ ุงูุขุฎุฑ
            changePlayerTurn();
        });
    }
    
    // ุฒุฑ ุงูุฌุฑุณ
    const bellButton = document.getElementById('bell-button');
    if (bellButton) {
        bellButton.addEventListener('click', function() {
            const bellAnswerSection = document.getElementById('bell-answer-section');
            if (bellAnswerSection) {
                bellAnswerSection.style.display = 'flex';
            }
            showToast('ุชู ุถุบุท ุงูุฌุฑุณ! ุฃุฏุฎู ุฅุฌุงุจุชู ุงูุขู', 'info');
        });
    }
    
    // ุฒุฑ ุชูุฏูู ุฅุฌุงุจุฉ ุงูุฌุฑุณ
    const submitBellBtn = document.getElementById('submit-bell-answer');
    if (submitBellBtn) {
        submitBellBtn.addEventListener('click', function() {
            const answer = document.getElementById('bell-answer').value.trim();
            if (!answer) {
                showToast('ูุฑุฌู ุฅุฏุฎุงู ุฅุฌุงุจุฉ', 'error');
                return;
            }
            
            if (checkBellAnswer(answer)) {
                showToast('ุฅุฌุงุจุฉ ุตุญูุญุฉ! ๐', 'success');
                
                // ุชุญุฏูุซ ุงููุชูุฌุฉ
                updatePlayerScore(gameState.playerId, 1);
                
                // ุงูุงูุชูุงู ููุณุคุงู ุงูุชุงูู
                moveToNextQuestion();
            } else {
                showToast('ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ', 'error');
                // ุชุบููุฑ ุงูุฏูุฑ ููุงุนุจ ุงูุขุฎุฑ
                changePlayerTurn();
            }
        });
    }
    
    // ุฒุฑ ุชูุฏูู ุฅุฌุงุจุฉ ุงููุณูุฑุฉ
    const submitCareerBtn = document.getElementById('submit-career');
    if (submitCareerBtn) {
        submitCareerBtn.addEventListener('click', function() {
            const answer = document.getElementById('career-answer').value.trim();
            if (!answer) {
                showToast('ูุฑุฌู ุฅุฏุฎุงู ุฅุฌุงุจุฉ', 'error');
                return;
            }
            
            if (checkCareerAnswer(answer)) {
                showToast('ุฅุฌุงุจุฉ ุตุญูุญุฉ! ๐', 'success');
                
                // ุชุญุฏูุซ ุงููุชูุฌุฉ
                updatePlayerScore(gameState.playerId, 1);
                
                // ุงูุงูุชูุงู ููุณุคุงู ุงูุชุงูู
                moveToNextQuestion();
            } else {
                showToast('ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ', 'error');
            }
        });
    }
    
    // ===== ูุธุงุฆู ุงููุนุจุฉ ุงูุฅุถุงููุฉ =====
    
    // ุชุญุฏูุซ ูุชูุฌุฉ ุงููุงุนุจ
    function updatePlayerScore(playerId, points) {
        if (!gameState.roomCode || !playerId) return;
        
        const playerRef = database.ref(`rooms/${gameState.roomCode}/players/${playerId}`);
        
        playerRef.once('value').then(snapshot => {
            const currentScore = snapshot.val().score || 0;
            return playerRef.update({
                score: currentScore + points
            });
        });
    }
    
    // ุชุบููุฑ ุฏูุฑ ุงููุงุนุจ
    function changePlayerTurn() {
        if (!gameState.roomCode) return;
        
        const nextPlayer = gameState.playerId === 'player1' ? 'player2' : 'player1';
        
        database.ref(`rooms/${gameState.roomCode}/gameState`).update({
            currentTurn: nextPlayer
        });
    }
    
    // ุงูุงูุชูุงู ููุณุคุงู ุงูุชุงูู
    function moveToNextQuestion() {
        if (!gameState.roomCode) return;
        
        const gameStateRef = database.ref(`rooms/${gameState.roomCode}/gameState`);
        
        gameStateRef.once('value').then(snapshot => {
            const currentData = snapshot.val();
            let nextQuestion = (currentData.currentQuestion || 0) + 1;
            let nextRound = currentData.currentRound || 1;
            
            // ุงูุชุญูู ูู ุงูุชูุงุก ุฃุณุฆูุฉ ุงูุฌููุฉ
            if (nextQuestion > 5) {
                nextQuestion = 1;
                nextRound += 1;
                
                // ุงูุชุญูู ูู ุงูุชูุงุก ุงููุนุจุฉ
                if (nextRound > 4) {
                    // ุงูุชูุงุก ุงููุนุจุฉ
                    endGame();
                    return;
                }
            }
            
            return gameStateRef.update({
                currentQuestion: nextQuestion,
                currentRound: nextRound
            });
        });
    }
    
    // ุงูุชูุงุก ุงููุนุจุฉ
    function endGame() {
        if (!gameState.roomCode) return;
        
        database.ref(`rooms/${gameState.roomCode}`).update({
            status: 'completed'
        });
        
        // ุนุฑุถ ุดุงุดุฉ ุงููุชุงุฆุฌ
        showScreen('results-screen');
    }
});
</script>
</body>
</html>
